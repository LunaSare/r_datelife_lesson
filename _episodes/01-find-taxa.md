---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 01-find-taxa.md in _episodes_rmd/
source: Rmd
title: "Finding your taxa in the Open Tree of Life Taxonomy"
teaching: 5
exercises: 5
questions:
- "What is the Open Tree of Life Taxonomy?"
- "What are OTT ids?"
- 'What does TNRS stand for?'
objectives:
- "Getting OTT ids for some taxa."
- "Understanding TNRS and approximate matching."
# - "Finding the utility of taxonomic contexts"
# - "Discovering functions to handle a 'match_names' object."
keypoints:
- "Open Tree of Life Taxonomy ids, or OTT ids are unique numeric identifiers for individual taxa that the Open Tree of Life project uses to handle taxonomy."
# - "taxonomic context is very important to find the correct OTT ids for our taxa."
- "You can go from a scientific name to an OTT id using TNRS matching."
- "You can not go from a common name to OTT id using the Open Tree of Life tools."
---

~~~
## Warning in collapse_singles(tr, show_progress): Dropping singleton nodes
## with labels: Rana clamitans ott515378, Rana sphenocephala ott61437, Rana
## aurora ott771201, Glandirana ott407917, Pterorana ott3618410, Pelophylax
## cf ott7070897, Hemimantis ott4133632, Microdiscopus ott4133623, Montorana
## ott4133633, Chiromantis vittatus ott389176, Mercurana ott4133643, Beddomixalus
## ott4133641, Buergeriinae ott223222, Maitsomantis ott678997, Boehmantis
## ott484429, laevigata group ott189959, bernhardi group ott189958, Wakea
## ott484449, Tsingymantis ott976861, Boophinae ott764200, Laliostoma ott1054409,
## Ombrana ott4133654, Chrysopaa ott4133659, Alcalinae ott5926144, Liurananinae
## ott5926192, Natalobatrachus ott532110, Nothophryne ott3618085, Cacosternum
## nanum ott676305, Microbatrachella ott751405, Poyntonia ott475120, Anhydrophryne
## ott113819, Ericabatrachus ott3618087, Phrynobatrachidae ott504589, Micrixalidae
## ott1081209, Odontobatrachidae ott5536254, Lanzarana ott3618164, Trichobatrachus
## ott780979, Pararthroleptis ott4133674, Hyperolius fusciventris ott85268,
## Chlorolius ott3619081, Tachycnemis (genus in Deuterostomia) ott750024, Morerella
## ott85260, Kassinula ott3619075, Opisthothylax ott645881, Chrysobatrachus
## ott3619077, Callixalus ott3619073, Arlequinus ott3619083, Semnodactylus
## ott62328, Tornierella ott4133669, Breviceps adspersus ott3618690, Spelaeophryne
## ott660153, Probreviceps macrodactylus ott111206, Balebreviceps ott348136,
## Hemisotidae ott165721, Oninia ott789802, Genyophryne ott21522, Siamophryne
## ott7070469, Melanobatrachus ott701612, Kalophrynidae ott977735, Phrynella (genus
## in Opisthokonta) ott401609, Mysticellus ott7070618, Dermatonotus ott186184,
## Gastrophryne olivacea ott565409, Arcovomer ott844415, Adelastinae ott5800508,
## Adelastes ott3618939, Dasypops ott513414, Relictivomer ott190096, Anilany
## ott5926118, Madecassophryne ott3618941, Parhoplophryne ott3618937, Otophryninae
## ott404351, Phrynomerinae ott630304, Caluella ott7666463, Corythomantis
## ott442032, Argenteohyla ott578372, Argenteohyla siemersi ott100569, Nyctimantis
## ott1087156, Itapotihyla ott257368, Hyla annectans ott655531, Anotheca ott59159,
## Diaglena ott3620134, Acris crepitans ott59141, Quilticohyla ott7070260, Rheohyla
## ott7070262, Nesorohyla ott7070190, Pachymedusa ott254792, Dryaderces ott7666055,
## Didynamipus ott152264, Barbarophryne ott5800473, Churamiti ott104959, Bufotes
## pewzowi ott1072351, Schismaderma ott506368, Sabahphrynus ott4133471, Strauchbufo
## ott6158681, Epidalea ott334615, Anaxyrus americanus ott889326, Laurentophryne
## ott3619734, Parapelophryne ott3619737, Pseudobufo ott3619739, Bufoides
## ott3619731, Metaphryniscus ott3619751, Blythophryne ott5926045, Ghatophryne
## ott7069948, Rentapia ott7069968, Silverstoneia nubicola ott638061, Hyloxalinae
## ott1096759, Lithodytes ott315881, Scythrophrys ott462991, Rupirana ott3620326,
## Phrynocerus ott3619498, Physalalemus ott6158772, Niedenia ott4133301,
## Allophrynidae ott57740, Macrogenioglottus ott726713, Insuetophrynus ott44381,
## Telmatobiinae ott777187, Hylorina ott440882, Chaltenobatrachus ott6158620,
## Limnomedusa ott914517, Chacophrys ott431943, Caudiverbera ott1068325,
## Atopophrynus ott3620196, Geobatrachus ott3620197, Ceuthomantinae ott277741,
## Megistolotis ott276283, Adelotus ott276281, Assa (genus in Opisthokonta)
## ott906692, Paracrinia ott989413, Metacrinia ott412471, Spicospina ott1039925,
## Rheobatrachidae ott918183, Hadromophryne ott971912, Atympanophrys ott542885,
## Vibrissaphora ott535112, Pelodytidae ott509554, Xenopodinae ott940173,
## Pseudhymenochirus ott140873, Rhinophrynidae ott459016, Rhinophrynus ott459015,
## Alytinae ott5334814, Discoglossus galganoi ott461369, Latonia ott4948216,
## Leiopelmatidae ott611960, Ascaphidae ott1013114, Pelodryadidae ott3620482,
## Ranoidea (genus in family Pelodryadidae) ott7666856, Iranodon ott7071233,
## Ranodon ott834698, Satobius ott5800418, Pachyhynobius ott1021854, Ambystomatidae
## ott984723, Dicamptodontidae ott60819, Laotriton ott4948201, Triturus marmoratus
## ott1041767, Triturus carnifex ott1041783, Ommatotriton ophryticus ott645229,
## Lissotriton helveticus ott9366, Lissotriton boscai ott830424, Tylototriton
## verrucosus ott932561, Tylototriton wenxianensis ott981376, Pleurodeles waltl
## ott566038, Lyciasalamandra fazilae ott1024882, Salamandrininae ott4948210,
## Pingia ott4132654, Isthmura bellii ott46162, Isthmura sierraoccidentalis
## ott98841, Parvimolge ott46159, Bradytriton ott798666, Nyctanolis ott224306,
## Haideotriton ott133635, Eurycea multiplicata ott839995, Stereochilus (genus
## in Opisthokonta) ott798664, Hemidactylium ott798658, Phaeognathus ott964128,
## Karsenia ott893551, Ensatina ott64118, Hydromantes imperialis ott675243,
## Atylodes (genus in Deuterostomia) ott693464, Hydromantoides ott4132648,
## Amphiumidae ott566022, Rhyacotritonidae ott459010, Sirenoidea ott336754,
## Chikilidae ott4948197, Praslinia ott80530, Sylvacaecilia ott3617918,
## Atretochoana ott3617929, Potamotyphlus ott7667119, Bdellophis ott4132629
~~~
{: .warning}



~~~
## Warning in collapse_singles(tr, show_progress): Dropping singleton nodes with
## labels: Lycaon ott821959, Cuon alpinus ott313163, Eucyon ott3612566, Atelocynus
## ott621180, Chrysocyon ott621163, Canis mesomelas ott666235
~~~
{: .warning}
<br/>
<br/>

<!-- ### The Open Tree Taxonomy and its identifiers -->

The [Open Tree of Life Taxonomy](https://tree.opentreeoflife.org/about/taxonomy-version/ott3.2) (**OTT** from now on) synthesizes taxonomic information from different sources and assigns each taxon a unique numeric identifier, which we refer to as the **OTT id**. To interact with the OTT (and any other Open Tree of Life services) using R, we will learn how to use the functions from the `rotl` package. If you don't know if you have the package installed, go to [setup](../setup.html) and follow the instructions there.

To deal with synonyms and scientific name misspellings, the Open Tree Taxonomy uses
the [Taxonomic Name Resolution Service](http://tnrs.iplantcollaborative.org/) (**TNRS**
from now on), that allows linking scientific names to a unique OTT id, while dealing
with misspellings, synonyms and scientific name variants. The functions from `rotl` that interact
with OTT's TNRS start with "tnrs_".

<br/>

### Getting OTT ids for a taxon

To get OTT ids for a taxon or set of taxa we will use the function `tnrs_match_names()`.
This function takes a character vector of one or more scientific names as main argument.

> ## Hands on! Running TNRS
>
> Do a `tnrs_match_names()` run for the amphibians (Amphibia). Save the output to an object named `resolved_name`.
>
> You can try different misspellings and synonyms of your taxon to see TNRS in action.
>
>
> 
> ~~~
> resolved_name <- rotl::tnrs_match_names(names = "amphibians")
> resolved_name
> ~~~
> {: .language-r}
> 
> 
> 
> ~~~
>   search_string unique_name approximate_match ott_id is_synonym flags
> 1    amphibians    Amphibia              TRUE 544595      FALSE      
>   number_matches
> 1              6
> ~~~
> {: .output}
>
>
{: .challenge}

Ok, we were able to run the function `tnrs_match_names` successfully. Now, let's explore the structure of the output.

<br/>

### The 'match_names' object

As we can tell from the data printed to screen, the output of the `tnrs_match_names` function is some sort of a data table. In R (and all object-oriented programmming languages), defined data structures called [**classes**](https://www.datamentor.io/r-programming/object-class-introduction/) are assigned to objects. This makes data manipulation and usage of objects across different functions much easier.
Redundantly, a class is defined as a data structure that is the same among all objects that belong to the same class. However, we can do more to understadn the structure of any class,
To get the name of the class of the `tnrs_match_names()` output, we will use the function `class`.


~~~
class(resolved_name)
~~~
{: .language-r}



~~~
[1] "match_names" "data.frame" 
~~~
{: .output}

<br/>

As you can see, an object can belong to one or more classes.

Indeed, R is telling us that the output of `tnrs_match_names()` is a data frame (a type of table) and a **'match_names' object**, which is in turn a data frame with exactly 7 named columns: `search_string`, `unique_name`, `approximate_match`, `ott_id`, `is_synonym`, `flags`, and `number_matches`.
<!-- **search_string**, **unique_name**, **approximate_match**, **ott_id**, **is_synonym**, **flags**, and **number_matches**. -->

Next we will explore the kinds of data that are stored in each of the columns of a 'match_names' object.

<br/>

### Kinds of data stored in a 'match_names' object

You should have a good idea by now of what type of data is stored in the `ott_ids` column.

Can you guess what type of data is displayed in the column `search_string` and `unique_name`?

How about `is_synonym`?

The column `approximate_match` tells us whether the unique name was inferred from the search string using approximate matching (TRUE) or not (FALSE).

<!-- The column `number_matches` tells us how many -->

Finally, the `flags` column tells us if our unique name has been flagged in the OTT
(TRUE) or not (FALSE). It also indicates the type of flag associated to the taxon. Flags are markers that indicate if the taxon in question is problematic and should be included in further analyses of the Open Tree workflow. You can read more about flags in the [Open Tree wiki](https://github.com/OpenTreeOfLife/reference-taxonomy/wiki/Taxon-flags).

Now we know what kind of data is retrieved by the `tnrs_match_names()` function. Pretty cool!

<br/>

> > ## Pro tip 1.1: Looking at "hidden" elements of a data object
> >
> > The 'match_names' object has more data that is not exposed on the screen and is not part of the main data structure. This "hidden" data is stored in the attributes of the object.
> > All objects have at least one attribute, the class. If an object has more attributes, these can be accesed with the function `attributes()`.
> >
> > Let's explore the attributes and class of a basic object, such as a character vector. It certainly has a class:
> >
> > 
> > ~~~
> > class(c("Hello!", "my", "name", "is", "Luna!"))
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "character"
> > ~~~
> > {: .output}
> > But what about other attributes:
> >
> > 
> > ~~~
> > attributes(c("Hello!", "my", "name", "is", "Luna!"))
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > NULL
> > ~~~
> > {: .output}
> >
> > As you can see, some objects have no hidden attributes.
> >
> > Let's look for hidden attributes on our 'match_names' object:
> >
> > 
> > ~~~
> > attributes(resolved_name)
> > ~~~
> > {: .language-r}
> >
> > The structure of the "attributes" data is complicated and extracting it requires some exploring.
> >
> > 
> > ~~~
> > class(attributes(resolved_name))
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "list"
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > names(attributes(resolved_name))
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "names"              "row.names"          "class"             
> > [4] "original_order"     "original_response"  "match_id"          
> > [7] "has_original_match" "json_coords"       
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > str(attributes(resolved_name))
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > List of 8
> >  $ names             : chr [1:7] "search_string" "unique_name" "approximate_match" "ott_id" ...
> >  $ row.names         : int 1
> >  $ class             : chr [1:2] "match_names" "data.frame"
> >  $ original_order    : num 1
> >  $ original_response :List of 10
> >   ..$ context                     : chr "All life"
> >   ..$ governing_code              : chr "undefined"
> >   ..$ includes_approximate_matches: logi TRUE
> >   ..$ includes_deprecated_taxa    : logi FALSE
> >   ..$ includes_suppressed_names   : logi FALSE
> >   ..$ matched_names               :List of 1
> >   .. ..$ : chr "amphibians"
> >   ..$ results                     :List of 1
> >   .. ..$ :List of 2
> >   .. .. ..$ matches:List of 6
> >   .. .. .. ..$ :List of 7
> >   .. .. .. .. ..$ is_approximate_match: logi TRUE
> >   .. .. .. .. ..$ is_synonym          : logi FALSE
> >   .. .. .. .. ..$ matched_name        : chr "Amphibina"
> >   .. .. .. .. ..$ nomenclature_code   : chr "ICZN"
> >   .. .. .. .. ..$ score               : num 0.778
> >   .. .. .. .. ..$ search_string       : chr "amphibians"
> >   .. .. .. .. ..$ taxon               :List of 10
> >   .. .. .. .. .. ..$ flags                   : list()
> >   .. .. .. .. .. ..$ is_suppressed           : logi FALSE
> >   .. .. .. .. .. ..$ is_suppressed_from_synth: logi FALSE
> >   .. .. .. .. .. ..$ name                    : chr "Succinea"
> >   .. .. .. .. .. ..$ ott_id                  : int 978937
> >   .. .. .. .. .. ..$ rank                    : chr "genus"
> >   .. .. .. .. .. ..$ source                  : chr "ott3.3draft1"
> >   .. .. .. .. .. ..$ synonyms                :List of 12
> >   .. .. .. .. .. .. ..$ : chr "Amphibia"
> >   .. .. .. .. .. .. ..$ : chr "Amphibina"
> >   .. .. .. .. .. .. ..$ : chr "Arborcinea"
> >   .. .. .. .. .. .. ..$ : chr "Brachyspira"
> >   .. .. .. .. .. .. ..$ : chr "Cerinasota"
> >   .. .. .. .. .. .. ..$ : chr "Cochlohydra"
> >   .. .. .. .. .. .. ..$ : chr "Luccinea"
> >   .. .. .. .. .. .. ..$ : chr "Lucena"
> >   .. .. .. .. .. .. ..$ : chr "Succinaea"
> >   .. .. .. .. .. .. ..$ : chr "Succinastrum"
> >   .. .. .. .. .. .. ..$ : chr "Tapada"
> >   .. .. .. .. .. .. ..$ : chr "Truella"
> >   .. .. .. .. .. ..$ tax_sources             :List of 7
> >   .. .. .. .. .. .. ..$ : chr "worms:181586"
> >   .. .. .. .. .. .. ..$ : chr "ncbi:145426"
> >   .. .. .. .. .. .. ..$ : chr "gbif:2297197"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1393632"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1348813"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1133222"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1202351"
> >   .. .. .. .. .. ..$ unique_name             : chr "Succinea"
> >   .. .. .. ..$ :List of 7
> >   .. .. .. .. ..$ is_approximate_match: logi TRUE
> >   .. .. .. .. ..$ is_synonym          : logi FALSE
> >   .. .. .. .. ..$ matched_name        : chr "Amphibia"
> >   .. .. .. .. ..$ nomenclature_code   : chr "ICZN"
> >   .. .. .. .. ..$ score               : num 0.75
> >   .. .. .. .. ..$ search_string       : chr "amphibians"
> >   .. .. .. .. ..$ taxon               :List of 10
> >   .. .. .. .. .. ..$ flags                   : list()
> >   .. .. .. .. .. ..$ is_suppressed           : logi FALSE
> >   .. .. .. .. .. ..$ is_suppressed_from_synth: logi FALSE
> >   .. .. .. .. .. ..$ name                    : chr "Amphibia"
> >   .. .. .. .. .. ..$ ott_id                  : int 544595
> >   .. .. .. .. .. ..$ rank                    : chr "class"
> >   .. .. .. .. .. ..$ source                  : chr "ott3.3draft1"
> >   .. .. .. .. .. ..$ synonyms                :List of 1
> >   .. .. .. .. .. .. ..$ : chr "Lissamphibia"
> >   .. .. .. .. .. ..$ tax_sources             :List of 4
> >   .. .. .. .. .. .. ..$ : chr "ncbi:8292"
> >   .. .. .. .. .. .. ..$ : chr "worms:178701"
> >   .. .. .. .. .. .. ..$ : chr "gbif:131"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1131"
> >   .. .. .. .. .. ..$ unique_name             : chr "Amphibia"
> >   .. .. .. ..$ :List of 7
> >   .. .. .. .. ..$ is_approximate_match: logi TRUE
> >   .. .. .. .. ..$ is_synonym          : logi FALSE
> >   .. .. .. .. ..$ matched_name        : chr "Amphibia"
> >   .. .. .. .. ..$ nomenclature_code   : chr "ICN"
> >   .. .. .. .. ..$ score               : num 0.75
> >   .. .. .. .. ..$ search_string       : chr "amphibians"
> >   .. .. .. .. ..$ taxon               :List of 10
> >   .. .. .. .. .. ..$ flags                   :List of 1
> >   .. .. .. .. .. .. ..$ : chr "sibling_higher"
> >   .. .. .. .. .. ..$ is_suppressed           : logi FALSE
> >   .. .. .. .. .. ..$ is_suppressed_from_synth: logi FALSE
> >   .. .. .. .. .. ..$ name                    : chr "Bostrychia"
> >   .. .. .. .. .. ..$ ott_id                  : int 782484
> >   .. .. .. .. .. ..$ rank                    : chr "genus"
> >   .. .. .. .. .. ..$ source                  : chr "ott3.3draft1"
> >   .. .. .. .. .. ..$ synonyms                :List of 1
> >   .. .. .. .. .. .. ..$ : chr "Amphibia"
> >   .. .. .. .. .. ..$ tax_sources             :List of 5
> >   .. .. .. .. .. .. ..$ : chr "silva:AF203893/#6"
> >   .. .. .. .. .. .. ..$ : chr "ncbi:103711"
> >   .. .. .. .. .. .. ..$ : chr "worms:143904"
> >   .. .. .. .. .. .. ..$ : chr "gbif:2661216"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1282403"
> >   .. .. .. .. .. ..$ unique_name             : chr "Bostrychia (genus in kingdom Archaeplastida)"
> >   .. .. .. ..$ :List of 7
> >   .. .. .. .. ..$ is_approximate_match: logi TRUE
> >   .. .. .. .. ..$ is_synonym          : logi FALSE
> >   .. .. .. .. ..$ matched_name        : chr "Amphibia"
> >   .. .. .. .. ..$ nomenclature_code   : chr "ICZN"
> >   .. .. .. .. ..$ score               : num 0.75
> >   .. .. .. .. ..$ search_string       : chr "amphibians"
> >   .. .. .. .. ..$ taxon               :List of 10
> >   .. .. .. .. .. ..$ flags                   : list()
> >   .. .. .. .. .. ..$ is_suppressed           : logi FALSE
> >   .. .. .. .. .. ..$ is_suppressed_from_synth: logi FALSE
> >   .. .. .. .. .. ..$ name                    : chr "Egadroma"
> >   .. .. .. .. .. ..$ ott_id                  : int 732965
> >   .. .. .. .. .. ..$ rank                    : chr "genus"
> >   .. .. .. .. .. ..$ source                  : chr "ott3.3draft1"
> >   .. .. .. .. .. ..$ synonyms                :List of 1
> >   .. .. .. .. .. .. ..$ : chr "Amphibia"
> >   .. .. .. .. .. ..$ tax_sources             :List of 2
> >   .. .. .. .. .. .. ..$ : chr "ncbi:247376"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1307131"
> >   .. .. .. .. .. ..$ unique_name             : chr "Egadroma"
> >   .. .. .. ..$ :List of 7
> >   .. .. .. .. ..$ is_approximate_match: logi TRUE
> >   .. .. .. .. ..$ is_synonym          : logi FALSE
> >   .. .. .. .. ..$ matched_name        : chr "Amphibia"
> >   .. .. .. .. ..$ nomenclature_code   : chr "ICZN"
> >   .. .. .. .. ..$ score               : num 0.75
> >   .. .. .. .. ..$ search_string       : chr "amphibians"
> >   .. .. .. .. ..$ taxon               :List of 10
> >   .. .. .. .. .. ..$ flags                   : list()
> >   .. .. .. .. .. ..$ is_suppressed           : logi FALSE
> >   .. .. .. .. .. ..$ is_suppressed_from_synth: logi FALSE
> >   .. .. .. .. .. ..$ name                    : chr "Stenolophus"
> >   .. .. .. .. .. ..$ ott_id                  : int 561664
> >   .. .. .. .. .. ..$ rank                    : chr "genus"
> >   .. .. .. .. .. ..$ source                  : chr "ott3.3draft1"
> >   .. .. .. .. .. ..$ synonyms                :List of 6
> >   .. .. .. .. .. .. ..$ : chr "Agonoderos"
> >   .. .. .. .. .. .. ..$ : chr "Agonoderus"
> >   .. .. .. .. .. .. ..$ : chr "Amphibia"
> >   .. .. .. .. .. .. ..$ : chr "Astenolophus"
> >   .. .. .. .. .. .. ..$ : chr "Egadroma"
> >   .. .. .. .. .. .. ..$ : chr "Stenelophus"
> >   .. .. .. .. .. ..$ tax_sources             :List of 3
> >   .. .. .. .. .. .. ..$ : chr "ncbi:177549"
> >   .. .. .. .. .. .. ..$ : chr "gbif:8401238"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1330562"
> >   .. .. .. .. .. ..$ unique_name             : chr "Stenolophus"
> >   .. .. .. ..$ :List of 7
> >   .. .. .. .. ..$ is_approximate_match: logi TRUE
> >   .. .. .. .. ..$ is_synonym          : logi FALSE
> >   .. .. .. .. ..$ matched_name        : chr "Amphibia"
> >   .. .. .. .. ..$ nomenclature_code   : chr "ICZN"
> >   .. .. .. .. ..$ score               : num 0.75
> >   .. .. .. .. ..$ search_string       : chr "amphibians"
> >   .. .. .. .. ..$ taxon               :List of 10
> >   .. .. .. .. .. ..$ flags                   : list()
> >   .. .. .. .. .. ..$ is_suppressed           : logi FALSE
> >   .. .. .. .. .. ..$ is_suppressed_from_synth: logi FALSE
> >   .. .. .. .. .. ..$ name                    : chr "Succinea"
> >   .. .. .. .. .. ..$ ott_id                  : int 978937
> >   .. .. .. .. .. ..$ rank                    : chr "genus"
> >   .. .. .. .. .. ..$ source                  : chr "ott3.3draft1"
> >   .. .. .. .. .. ..$ synonyms                :List of 12
> >   .. .. .. .. .. .. ..$ : chr "Amphibia"
> >   .. .. .. .. .. .. ..$ : chr "Amphibina"
> >   .. .. .. .. .. .. ..$ : chr "Arborcinea"
> >   .. .. .. .. .. .. ..$ : chr "Brachyspira"
> >   .. .. .. .. .. .. ..$ : chr "Cerinasota"
> >   .. .. .. .. .. .. ..$ : chr "Cochlohydra"
> >   .. .. .. .. .. .. ..$ : chr "Luccinea"
> >   .. .. .. .. .. .. ..$ : chr "Lucena"
> >   .. .. .. .. .. .. ..$ : chr "Succinaea"
> >   .. .. .. .. .. .. ..$ : chr "Succinastrum"
> >   .. .. .. .. .. .. ..$ : chr "Tapada"
> >   .. .. .. .. .. .. ..$ : chr "Truella"
> >   .. .. .. .. .. ..$ tax_sources             :List of 7
> >   .. .. .. .. .. .. ..$ : chr "worms:181586"
> >   .. .. .. .. .. .. ..$ : chr "ncbi:145426"
> >   .. .. .. .. .. .. ..$ : chr "gbif:2297197"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1393632"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1348813"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1133222"
> >   .. .. .. .. .. .. ..$ : chr "irmng:1202351"
> >   .. .. .. .. .. ..$ unique_name             : chr "Succinea"
> >   .. .. ..$ name   : chr "amphibians"
> >   ..$ taxonomy                    :List of 5
> >   .. ..$ author : chr "open tree of life project"
> >   .. ..$ name   : chr "ott"
> >   .. ..$ source : chr "ott3.3draft1"
> >   .. ..$ version: chr "3.3"
> >   .. ..$ weburl : chr "https://tree.opentreeoflife.org/about/taxonomy-version/ott3.3"
> >   ..$ unambiguous_names           : list()
> >   ..$ unmatched_names             : list()
> >  $ match_id          : int 2
> >  $ has_original_match: logi TRUE
> >  $ json_coords       :'data.frame':	1 obs. of  4 variables:
> >   ..$ search_string     : chr "amphibians"
> >   ..$ original_order    : num 1
> >   ..$ match_id          : int 2
> >   ..$ has_original_match: logi TRUE
> > ~~~
> > {: .output}
> >
> > There are many hidden attributes on our 'match_names' object. The function `synonyms()` in the package `rotl` can extract the synonyms from the attributes of a 'match_names' object.
> >
> >
> > 
> > ~~~
> > rotl::synonyms(resolved_name)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > $Amphibia
> > [1] "Lissamphibia"
> > 
> > attr(,"class")
> > [1] "otl_synonyms" "list"        
> > ~~~
> > {: .output}
> >
> > That's neat!
> >
> {: .solution}
{: .testimonial}

<br/>

### Getting OTT ids for multiple taxon names at a time

Now that we know about classes and the data structure of the `tnrs_match_names` output, we will learn how to use the tnrs_match_names function for multiple taxa.
In this case, you will have to create a character vector with your taxon names and use it as input for `tnrs_match_names`:

<br/>

> ## Hands on! Running TNRS for multiple taxa
>
> Do a `tnrs_match_names()` run for the amphibians (Amphibia), the genus of the dog (_Canis_),
> the genus of the cat (_Felis_), the family of dolphins (Delphinidae), and the class
> of birds (Aves). Save the output to an object named `resolved_names`.
>
> Again, you can try different misspellings and synonyms of your taxa to see TNRS in action.
>
>
> 
> ~~~
> my_taxa <- c("amphibians", "canis", "felis", "delphinidae", "avess")
> resolved_names <- rotl::tnrs_match_names(names = my_taxa, context_name = "All life")
> resolved_names
> ~~~
> {: .language-r}
> 
> 
> 
> ~~~
>   search_string unique_name approximate_match ott_id is_synonym flags
> 1    amphibians    Amphibia              TRUE 544595      FALSE      
> 2         canis       Canis             FALSE 372706      FALSE      
> 3         felis       Felis             FALSE 563165      FALSE      
> 4   delphinidae Delphinidae             FALSE 698406      FALSE      
> 5         avess        Aves              TRUE  81461      FALSE      
>   number_matches
> 1              6
> 2              2
> 3              1
> 4              1
> 5              1
> ~~~
> {: .output}
>
{: .challenge}

### ❗

You should get a matched named for all the taxa in this example. If you do not get a match for all your taxa, and you get an unexpected warning message, it means that the `tnrs_match_names` function might not be working as expected. Please refer to Pro tip 1.2 below for alternative ways to get OTT ids for multiple taxa at a time using `tnrs_match_names`.

Finally, we are going to learn how to extract specific pieces of data from a `match_names` object to use in other functions and workflows.

<br/>

> > ## Pro Tip 1.2: Getting OTT ids for multiple taxa, the hacker way.
> >
> > If you get a warning message saying that any of your taxon names "are not matched", it means that the `tnrs_match_names` function is not implementig TNRS for inputs with more than one name. This is an unexpected behaviour. See [this GitHub issue](https://github.com/ropensci/rotl/issues/134) for updates.
> >
> > As you already know, running `tnrs_match_names` using one name at a time, works as expected:
> >
> > 
> > ~~~
> > rotl::tnrs_match_names(names = "amphibians", do_approximate_matching = TRUE)
> > rotl::tnrs_match_names(names = "avess", do_approximate_matching = TRUE)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> >   search_string unique_name approximate_match ott_id is_synonym flags
> > 1    amphibians    Amphibia              TRUE 544595      FALSE      
> >   number_matches
> > 1              6
> >   search_string unique_name approximate_match ott_id is_synonym flags
> > 1         avess        Aves              TRUE  81461      FALSE      
> >   number_matches
> > 1              1
> > ~~~
> > {: .output}
> >
> > If we want to run the function for a multiple element character vector, we can use a loop or an `sapply`, which will run the function individually for each taxa within `my_taxa`, avoiding the unexpected behaviours observed above.
> >
> >
> > Let's try it using `sapply`:
> >
> > 
> > ~~~
> > resolved_names <- sapply(my_taxa, rotl::tnrs_match_names)
> > class(resolved_names)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "matrix" "array" 
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > resolved_names
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> >                   amphibians   canis   felis   delphinidae   avess  
> > search_string     "amphibians" "canis" "felis" "delphinidae" "avess"
> > unique_name       "Amphibia"   "Canis" "Felis" "Delphinidae" "Aves" 
> > approximate_match TRUE         FALSE   FALSE   FALSE         TRUE   
> > ott_id            544595       372706  563165  698406        81461  
> > is_synonym        FALSE        FALSE   FALSE   FALSE         FALSE  
> > flags             ""           ""      ""      ""            ""     
> > number_matches    6            2       1       1             1      
> > ~~~
> > {: .output}
> >
> > The data structure is not the same as we obtained using a single taxon name. To get that same data frame structure, we can transpose the output `resolved_names` with the function `t`, and make it a data.frame with the function `as.data.frame`:
> >
> > 
> > ~~~
> > resolved_names <- t(resolved_names)
> > resolved_names <- as.data.frame(resolved_names)
> > resolved_names
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> >             search_string unique_name approximate_match ott_id is_synonym flags
> > amphibians     amphibians    Amphibia              TRUE 544595      FALSE      
> > canis               canis       Canis             FALSE 372706      FALSE      
> > felis               felis       Felis             FALSE 563165      FALSE      
> > delphinidae   delphinidae Delphinidae             FALSE 698406      FALSE      
> > avess               avess        Aves              TRUE  81461      FALSE      
> >             number_matches
> > amphibians               6
> > canis                    2
> > felis                    1
> > delphinidae              1
> > avess                    1
> > ~~~
> > {: .output}
> > 
> > 
> > 
> > ~~~
> > class(resolved_names)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "data.frame"
> > ~~~
> > {: .output}
> >
> > Our object is now a data frame, but it is not a 'match_names' object
> > As we mentioned above, classes are used by functions to recognise suitable data structure of objects. To use this object with other functions from the `rotl` pacakge, we will have to add 'match_names' to the class of our object:
> >
> > 
> > ~~~
> > class(resolved_names) <- c("match_names", "data.frame")
> > class(resolved_names)
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > [1] "match_names" "data.frame" 
> > ~~~
> > {: .output}
> >
> > Changing the class attribute does not change the actual structure of the object:
> > 
> > ~~~
> > resolved_names
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> >             search_string unique_name approximate_match ott_id is_synonym flags
> > amphibians     amphibians    Amphibia              TRUE 544595      FALSE      
> > canis               canis       Canis             FALSE 372706      FALSE      
> > felis               felis       Felis             FALSE 563165      FALSE      
> > delphinidae   delphinidae Delphinidae             FALSE 698406      FALSE      
> > avess               avess        Aves              TRUE  81461      FALSE      
> >             number_matches
> > amphibians               6
> > canis                    2
> > felis                    1
> > delphinidae              1
> > avess                    1
> > ~~~
> > {: .output}
> >
> {: .solution}
{: .testimonial}

<br/>

### Extracting data from a 'match_names' object

It is easy to access elements from a 'match_names' object using regular indexing.
For example, using the column number, we can extract all elements from a certain column.
Let's extract all data from the second column:


~~~
resolved_names[,2]
~~~
{: .language-r}



~~~
$amphibians
[1] "Amphibia"

$canis
[1] "Canis"

$felis
[1] "Felis"

$delphinidae
[1] "Delphinidae"

$avess
[1] "Aves"
~~~
{: .output}
We can also use the name of the column so we do not have to remember its position:

~~~
resolved_names[,"unique_name"]
~~~
{: .language-r}



~~~
$amphibians
[1] "Amphibia"

$canis
[1] "Canis"

$felis
[1] "Felis"

$delphinidae
[1] "Delphinidae"

$avess
[1] "Aves"
~~~
{: .output}
Because it is a 'data.frame', we can also access the values of any column by using
the "$" and the column name to index it, like this:


~~~
resolved_names$unique_name
~~~
{: .language-r}



~~~
$amphibians
[1] "Amphibia"

$canis
[1] "Canis"

$felis
[1] "Felis"

$delphinidae
[1] "Delphinidae"

$avess
[1] "Aves"
~~~
{: .output}

The 'match_names' object has a relatively simple structure that is easy to explore and mine.
We will see later that the outputs of other `rotl` functions are more complicated
and accessing their elements requires a lot of hacking. Fortunately, the `rotl` creators have
added some functions that allow interacting with these complicated outputs.
The functions `unique_name()`, `ott_id()`, and `flags()` extract values from the
respective columns of a 'match_names' object, in the form of a list instead of a vector.
To extract data from the other columns there are no specialized functions, so you will have to index.

<br/>

> ## Hands on!  Extract the OTT ids from a 'match_names' object
>
> You now have a 'match_names' object that we called `resolved_names`. There are at least two ways to extract the OTT ids from it. Can you figure them out? Store them in an object we will call `my_ott_ids`.
>
> **Hint**: You can find one solution by browsing the [rotl package documentation](https://cran.r-project.org/web/packages/rotl/rotl.pdf) to find a function that will do this for a 'match_names' object.
>
> You will find a second solution by using your knowledge on data frames and tables to extract the data from the `ott_id` column.
>
> > ## Look at some solutions
> >
> > Get the OTT ids as a list, with the function `ott_id()`:
> >
> > 
> > ~~~
> > my_ott_id <- rotl::ott_id(resolved_names) # rotl:::ott_id.match_names(resolved_names) is the same.
> > my_ott_id
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > named list()
> > attr(,"class")
> > [1] "otl_ott_id" "list"      
> > ~~~
> > {: .output}
> >
> > Or, get the OTT ids as a vector:
> >
> > 
> > ~~~
> > my_ott_id <- resolved_names$ott_id # or resolved_names[, "ott_id"]
> > my_ott_id
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > $amphibians
> > [1] 544595
> > 
> > $canis
> > [1] 372706
> > 
> > $felis
> > [1] 563165
> > 
> > $delphinidae
> > [1] 698406
> > 
> > $avess
> > [1] 81461
> > ~~~
> > {: .output}
> >
<!-- > > Most of the functions we will explore later take an argument called _**ott_ids**_ in the form of a vector, not a list (?), so I usually prefer the second approach. -->
> {: .solution}
{: .challenge}

<br/>

There are no specialized functions to extract values from a row of a 'match_names' object, so we have to do some indexing.
You can get values from all columns of one row:


~~~
resolved_names[1,]
~~~
{: .language-r}



~~~
           search_string unique_name approximate_match ott_id is_synonym flags
amphibians    amphibians    Amphibia              TRUE 544595      FALSE      
           number_matches
amphibians              6
~~~
{: .output}

Or get just one specific value from a certain column, using the column name:

~~~
resolved_names[1,"unique_name"]
~~~
{: .language-r}



~~~
$amphibians
[1] "Amphibia"
~~~
{: .output}
Or using the column position:

~~~
resolved_names[1,2]
~~~
{: .language-r}



~~~
$amphibians
[1] "Amphibia"
~~~
{: .output}
<br/>
There we go! Now we know how to get OTT ids from a bunch of taxa of interest. Let's see what we can do with these on the next section.

<br/>

> > ## Pro tip 1.3: Name the rows of your 'match_names' object
> >
> > To facilitate the use of OTT ids later, you can name the rows of your 'match_names' object using the function `rownames()`.
> >
> > You can name them whatever you want. For example, you can use the `unique_name` identifier:
> >
> > 
> > ~~~
> > rownames(resolved_names) <- resolved_names$unique_name
> > resolved_names
> > ~~~
> > {: .language-r}
> >
> > Or simply call them something short that makes sense to you and is easy to remember:
> >
> > 
> > ~~~
> > rownames(resolved_names) <- c("amphs", "dogs", "cats", "flippers", "birds")
> > resolved_names
> > >  >
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > Error: <text>:3:1: unexpected '>'
> > 2: resolved_names
> > 3: >
> >    ^
> > ~~~
> > {: .error}
> >
> > This will facilitate accessing elements of the 'match_names' object by allowing to just use the row name as row index (instead of a number).
> >
> > There are at least two ways to do this.
> >
> > You can use the "$" to acces a named column of the data frame:
> > 
> > ~~~
> > resolved_names["flippers",]$ott_id
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > $<NA>
> > NULL
> > ~~~
> > {: .output}
> > Or, you can use the column name as column index:
> > 
> > ~~~
> > resolved_names["flippers","ott_id"]
> > ~~~
> > {: .language-r}
> > 
> > 
> > 
> > ~~~
> > $<NA>
> > NULL
> > ~~~
> > {: .output}
> > In both cases, you will get the OTT id of the Delphinidae. Cool!
> {: .solution}
{: .testimonial}

<!--

### Taxonomic contexts and updating a 'match_names' object

Running a TNRS match can take some time, so if you just want to update a few elements from your 'match_names' object, you can use the functions `inspect()` and `update()`.

The _Mus_ example is fixed.

## **Hack!**

Put together two 'match_names' objects with `c()` or `rbind()`
{: .callout} -->

<br/>

{% include links.md %}
