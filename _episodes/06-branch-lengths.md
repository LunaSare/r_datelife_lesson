---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 06-branch-lengths.md in _episodes_rmd/
source: Rmd
title: "Getting branch length information (proportional to time) for you taxa"
teaching: 5
exercises: 5
questions:
- "How do I find supporting trees?"
- "How do I know if they include branch lengths"
objectives:
- "Learn about the opentree_chronograms object from datelife"
- "Get source chronograms from the opentree_chronograms object for a set of taxa"
keypoints:
- "datelife gets chronograms using source trees from the Open Tree of Life phylesystem"
- "chronograms are retrieved at the species level only (for now)"
---


### Subset a list of studies or trees by some criteria

We can get a list of study and tree properties available with the function `studies_properties()`.
The values that this properties can take are listed in the [phylesystem API wiki](https://github.com/OpenTreeOfLife/phylesystem-api/wiki/NexSON).


To get get all trees with branch lengths poprotional to time, we use the function
`studies_find_trees()`, with the property "ot:branchLengthMode" and the value "ot:time".
It takes some time for it to get all the information.

> ## Extra! Try it yourself.
>
> 
> ~~~
> chronograms <- rotl::studies_find_trees(property = "ot:branchLengthMode", value = "ot:time", verbose = TRUE, detailed = TRUE)
> ~~~
> {: .language-r}
> 
> ~~~
> class(chronograms)
> names(chronograms)
> ~~~
> {: .language-r}
> We should be able to use `list_trees()` to get all trees matching our criteria.
> 
> ~~~
> rotl:::list_trees(chronograms)
> ~~~
> {: .language-r}
>
> Except, it does not really work.
{: .testimonial}

In the package `datelife`, we have implemented a workflow that extracts all studies containing information from at least two taxa.

You can get all source chronograms from an induced subtree, as long as the tip labels
are in the "name" format (and not the default "name_and_id").


~~~
canis_node_subtree <- rotl::tol_induced_subtree(canis_node_ottids[canis_node_species], label = "name")
~~~
{: .language-r}



~~~
Error in .tol_induced_subtree(ott_ids = ott_ids, node_ids = node_ids, : object 'canis_node_ottids' not found
~~~
{: .error}



~~~
# important!! tip label should be name.
~~~
{: .language-r}


~~~
canis_dr <- datelife::get_datelife_result(canis_node_subtree)
~~~
{: .language-r}



~~~
Warning: Datelife Result object is empty.
~~~
{: .error}



~~~
Input taxa were not found across available chronograms.
~~~
{: .output}



~~~
Setting use_tnrs = TRUE might change this, but it is time consuming.
~~~
{: .output}

~~~
names(canis_dr)
~~~
{: .language-r}



~~~
character(0)
~~~
{: .output}



~~~
canis_dr[1] # look at the first element of the list
~~~
{: .language-r}



~~~
$<NA>
NULL
~~~
{: .output}



~~~
apes_dr[length(canis_dr)] # look at the last element of the list
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'apes_dr' not found
~~~
{: .error}

We have now a list of matrices storing time of lineage divergence data for all taxon pairs.
Lists are named by the study citation, so we have that information handy at all times.

It is really easy to go from a matrix to a tree:


~~~
canis_phylo_all <-  datelife::summarize_datelife_result(canis_dr,summary_format = "phylo_all")
~~~
{: .language-r}



~~~
datelife_query argument is empty: showing taxon distribution of taxa found only in at least one chronogram. This excludes input taxa not found in any chronogram.
~~~
{: .output}



~~~
Error in `rownames<-`(`*tmp*`, value = paste0("Chronogram", sequence(nrow(taxon_matrix)))): attempt to set 'rownames' on an object with no dimensions
~~~
{: .error}
